const config = require("../modules/config.json");

const Canvas = require('canvas');

const { Discord, Attachment } = require('discord.js');

module.exports = {
  name: 'welcometest',
  description: 'aaa',
  execute: async (message) => {

    const channel = message.member.guild.channels.cache.find(ch => ch.name === config.welcome_channel);
    if (!channel) return;

    const canvas = Canvas.createCanvas(750, 250);

    const ctx = canvas.getContext('2d');

    const background = await Canvas.loadImage("./images/welcome.png");

    ctx.drawImage(background, 0, 0, canvas.width, canvas.height);
    ctx.strokeStyle = "#161b28";
    ctx.strokeRect(0, 0, canvas.width, canvas.height);

    ctx.font = '70px sans-serif';
    ctx.fillStyle = "#ffffff";
    ctx.fillText(`Bienvenue !`, 50, 40);

    const avatar = await Canvas.loadImage(message.member.user.displayAvatarURL({ format: 'jpg' }));
    ctx.drawImage(avatar, 25, 25, 200, 200);

    ctx.beginPath();

    const attachment = new Discord.Attachment(canvas.toBuffer(), 'custom__image.png');

    await message.channel.send(attachment);

  }
}